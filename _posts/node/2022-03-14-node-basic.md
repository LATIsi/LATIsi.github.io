---
title: "node.js란 무엇인가? "
excerpt: "node에 대한 아키텍처나 간단한 기본 모듈 정리.."
date: 2022-03-13
categories:
  - node.js
tags:
  - node.js
last_modified_at: 2022-06-04
---

## node.js - 서버사이드 JS

C/C++ (레이어, 시스템 통합) 과 JS(대부분)로 만들어졌다.  
이벤트 기반 개발 가능, 비동기식 프로그래밍이 가능하며 `I/O 부하 심한 대규모 서비스 개발`에 적합하다.

node.js 전에는.. 원래는 `각각` 연결에 `스레드를 새롭게 추가한뒤 메모리를 작성해 처리`하는데 <br>
각각의 node의 연결이 하나의 이벤트로 처리하는 새로운 방법으로 연결을 처리했다.

<br>

즉, `I/O의 응답을 기다리지 않아도 되는 싱글 스레드`의 이벤트 기반 I/O 처리인 node.js를 사용한다.

<br>
  
node.js를 사용한 프로그램중에선 예시로 구글에서 제작한 V8 오픈 자바 스크립트 엔진(크롬 브라우저/ 안드로이드 브라우저)가 있다.  
멀티프로세스 모델에서 실행을 목표를 설계한 엔진

<br>

<Br>

v8의 구조

- 각자 목적에 맞게 라이브러리 위에서 동작한다.
- 이벤트를 받아 처리한다
- 노드는 서버동작 프로그래밍이 주 임무이기에 `소켓`이나 `http 프로토콜`을 사용해 데이터 송수신 기능을 포함한다.  
  <br>

<Br>

---

<br>

<Br>

## node.js 아키텍처(내부구조)

### 1. 노드 표준 라이브러리 Node Standard Library - (API)

`기본`. JS언어로 만들어 졌으며 노드 바인딩과 연결된다.  
실질적으로 v8과 연결해 특정 기능을 수행가능.

<Br>

### 2. 노드 바인딩

`노드 표준 라이브러리의 인터페이스 역할`  
 c/c++로 구성되었으며 `시스템 바인딩 레이어, 소켓, http 통신기능을` 제공한다.  
 그러나 dom의 기능을 제공하지 않는다.

 <Br>

### 3. V8 엔진

크롬에 내장되어있고, 독립적으로 실행이 가능하다.  
구글 오픈 JIT(Just-In-Time) VM의 JS엔진.

<Br>

### 4. 스레드 풀 (pool)

`libeio` 비동기 I/o 파일관련 작업 라이브러리로 구성.  
노드가 내부적으로 사용하며 특히 멀티스레드같은데 사용  
예시로... `read/write/open/close/state/unlink/fdatasync/mknod/readdir...` 같은것들.

 <Br>

... 그외에도 이것저것많다... 이벤트루프라던지 c-ares라던지.

<br>

<Br>

노드의 REPL (Read Eval Print Loop)  
JS 콘솔과 비슷한데 dom은 지원 안해준다! (엥!??!?)  
즉 그냥 `노드이동, 간단한 코드작성/실행, 문법확인/테스팅 수행` 같은 것만 해준다. 빠져나오려면 명령프롬포트처럼 ctrl+C 두번입력하기~

<br>

<Br>

---

<br>

<Br>

## node.js 모듈에 관하여

`모듈`이란, 기능을 쉽게 사용하기 위해 `메서드, 속성을 미리 정의`해서 모아둔것! 즉 관련 코드를 모아 `캡슐화`해 노드로 개발한 어플리케이션을 이루는 `기본조각`, `부품`같은 단위이다.

<br>

모듈 구조를 통해 앱을 구성하면 확장성을 가질수 있고, 모듈 단위 구성은 노드가 `commonJS 스택`을 준수하기 때문에 객체지향으로 앱을 구성할 수 있다.
<br>

또한 모듈은 파일과 1대 1로 대응을 하여 `.js`나 `.node` 확장자 명을 가지고 노드 확장 모듈 개발을 편리하게 할 수 있다.

<br>

<Br>

### node.js의 모듈 구분

<br>

| 모듈 종류              |                                                                                                설명                                                                                                |
| ---------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
| `기본 모듈`            |                                        `노드 기본설치, 파일 입출력, 이벤트, http 프로토콜` 등등.... <br> 노드의 비동기 입출력 처리 기본적 기능을 제공한다.                                         |
| `확장 모듈`            |                                                                          express나 mongodb같은 추가로 설치한 기능의 모듈.                                                                          |
| `일반 모듈(JS)`        |                                                               개발 방법에 따라 나뉜 모듈이다. 일반모듈은 간단히 JS로 만들어진 모듈.                                                                |
| `네이티브 모듈(C,C++)` |                                           일반 모듈보다는 좀 복잡하지만 더 나은 성능을 가지고 있다. <br> 또한 확장 모듈들도 네이티브 모듈이 될 수 있다!                                            |
| `글로벌 모듈`          |                                                     설치시 확장모듈 (-g 옵션)으로 설치한 모듈. <br> 한번 -g로 깔면 전체적으로 사용이 가능하다.                                                     |
| `로컬 모듈`            |                                                                   글로벌 모듈과는 다르게 그 파일,, 지정된 폴더에만 사용되는 모듈                                                                   |
| `복합 모듈`            | `내부모듈, 데이터파일, 템플릿, 테스트 코드들을 포함하는 모듈` <br> 다양한 파일 포함하기에 모든 구성 단위가 폴더이다. `require` 메서드가 인식할시, `index.js`나 `package.json` 둘중 하나가 꼭 필요~ |

<br>

<br>

node.js는 `require` 메서드로 외부 모듈을 가져올수 있다. 너무너무너무 많이 쓰이니 꼭 기억해두자!

<br>

예시의 모듈로는..

- http (웹서버)
- fs (파일가져올때, 예시로 `비동기 처리`인 `fs.readfile`이나 `동기 처리`로 파일을 읽고 출력하는 `fs.readfileSync` 같은게 있다.)
- events (node.js에서 비동기 이벤트관련 생성, 관리를 해주는 모듈이다.)
- http (웹서버)
- mon(monitor), 노드가 실행하는 파일이 속한 디렉터리를 감시하다 파일 수정시 `자동으로 노드 어플리케이션을 재시작/확장하는` 모듈.

<br>

<Br>

---

<br>

<Br>

## 모듈 식별자

<Br>

| 식별자 종류          |                                                            설명                                                            |
| -------------------- | :------------------------------------------------------------------------------------------------------------------------: |
| `상대적 식별자`      |    `현재의 위치 기준으로 입력` <br> `./경로....` 같은식으로 작성한다. `./`가 없을시, 현재 위치의 모듈을 찾을 수가 없다.    |
| `절대적 식별자`      |             `절대경로의 위치 입력` <br> /(루트) 에서부터 시작하여 처음부터 끝까지 모듈이 있는 경로를 입력한다.             |
| `최상위 레벨 식별자` | 아무것도 입력 안하고 `모듈이름만 입력`.<br> 기본 모듈에서 검색해 찾다가 못찾으면 상위 디렉토리를 차례대로 탐색해 찾아낸다. |

<br>

<Br>

---

---

<br>

<Br>

## node.js 객체

<Br>

| node.js에 내장된 객체 모듈 종류 |                                                                                                                                                                                                                                                                                                설명                                                                                                                                                                                                                                                                                                 |
| ------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
| `console 객체`                  |                                                                                                                                                                                                    콘솔에 관련된 객체, 주로 개발자모드(크롬에서는 f12)에서 사용하거나 조회할수있다. <br> 대표적으로 `.log() -콘솔 메시지, .time(label)- 시간 측정 시작, .timeEnd(label) - 시간측정 종료`가 있다.                                                                                                                                                                                                    |
| `process 객체`                  |                                                           `프로그램 관련 기능을 다루는 객체, node.js만의 객체이다` <br> 대표적으로 `.argv - 프로그램의 매개변수 정보 / .env()- 환경과 관련된 정보 `<br>`.version()- node.js의 버전출력 / .versions()-모듈들의 버전출력`<br>`.avch- 프로세서 아키텍처 관련 정보 / .platform- 플랫폼의 정보`등등이 있다.<br> 또한 메서드도 있는데 프로그램을 종료하는`exit();`, 현재 프로그램의 실행된 시간을 알려주는`uptime();`, 그리고 메모리 사용정보를 알려주는 `memoryUseage();`같은 메서드들이 있다.                                                           |
| `OS 객체 모듈`                  |                                                                                                                                                                  `운영체제, 시스템 정보 가져올수 있는 모듈`. <br> cpu나 메모리, 디스크용량같은것을 조회할수 있고 `require('os')으로 os 객체 모듈에 접근`할 수 있으며. <br> `os.Eol` - 운영체제의 개행문자(`\n`) 나 `os.cpus()` - cpu의 세부정보를 담은 객체 반환 같은 예시가 있다.                                                                                                                                                                  |
| `utility 객체`                  |                                                                                                                     `node.js의 보조기능`<br> `require('utility')으로 utility 객체 모듈에 접근`할 수 있으며. 예시로는 `.format(포맷,[포맷팅할 매개변수...]);`로 포맷팅된 문자열을 반환한다! <br> 또한 `.promisify()`로 화살표함수의 콜백패턴을 프로미스패턴으로 바꿔주는 메서드도 있다. <br> util 모듈 지원시, `util.inherits(자식,부모)`- 노드상속을 더 쉽게하는 메서드도 있다.                                                                                                                     |
| `file system 객체`              | `파일 처리와 관련된 작업을 모아둔 객체-모듈, 줄여서 fs로도 많이 부르고, 메서드도 굉장히 많다.` <br> 대부분이 동기와 비동기로 나뉘는데, 동시수행을 못하는 동기일시 Sync가 붙은 메서드이다.<br> 특히 파일입출력은 예외처리가 `거의 필수사항일 만큼 중요`하므로 동기식 예외처리로는 `try/catch`문을 사용하고, 비동기식 예외처리로는 `callback의 매개변수를 arr에 전달`한다. <br> 가장 많이 쓰이는 메서드로는 `fs.readFile(파일이름, 옵션, 콜백) `- 옵션 방식으로 읽고 완료시 콜백을 호출하거나 <br>`fs.writeFile(파일이름, 쓸 데이터, 옵션, 콜백)`- 옵션 방식으로 데이터를 작성완료시 콜백호출을 한다. |
| `event 객체`                    |                                                                                                                                                                            `이벤트를 발생/ 삭제시키는 기본적 메서드`. node.js에서 중요하고 이벤트 모듈과 이벤트emitter 클래스가 내장 되어있다! <br> 작성시 `대문자로 문자를 구분하는 카멜 표기법`을 많이 사용한다. <br> events 객체의 메서드는 많으니 아래에 따로 서술!                                                                                                                                                                             |

<br>

<Br>

<br>

<Br>

| 이벤트 객체 메서드                                        |                                                                                   설명                                                                                   |
| --------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
| `e.addListener(event.Listener) 또는 e.on(event.Listener)` |                                                                            이벤트 메서드 생성                                                                            |
| `e.once(event.Listener)`                                  |                                                                        이벤트 한번만 연결 뒤 제거                                                                        |
| `e.removeListener(event.Listener)`                        | 특정이벤트 핸들러 제거 & 리스너 인덱스 갱신 <br> 그런데 삭제를 하는 메서드는 e.removeListener() 말고도 `e.removeAllListener()`로 `모든 이벤트 리스너를 제거`할수도 있다. |
| `e.setMaxListener(n)`                                     |                                          한 이벤트에 `최대 n개의 허용갯수 지정`, 11개이상이나 0을주면 연결갯수 제한이 사라진다.                                          |
| `e.emit(이벤트 이름)`                                     |                                                                        지정한 이벤트를 발생시킴.                                                                         |

<br>

<br>

---

<br>

<Br>

~참고하면 좋을 정보~

<br>

Blocking I/O(시스템 콜) 이란?  
커널 사용시 app이 기다렸다가 켜지는등.... 곧장 실행되지않고 기다리는것을 blocked라고 한다.

<br>

<Br>

### 멀티 스레드

`CPU의 시분할`  
`스케쥴링, 복수요청 공유문제를 해결`하며 `직관적이며 멀티태스킹`을 할수있지만  
쓰레드 기반으로 동작시 I/O 기반 요청으로 응답이 돌아올때까지 기다리기에 `처리시간과 문맥전환비용이 발생`한다.

<br>

<Br>

---

<br>

<Br>

더욱 v8나 node.js의 구조에 자세히 알고싶다면 아래 링크를 참고!

### [https://dataonair.or.kr/db-tech-reference/d-lounge/technical-data/?mod=document&uid=236060](https://dataonair.or.kr/db-tech-reference/d-lounge/technical-data/?mod=document&uid=236060)

<br>

commonJS에 대해 좀 더 알고싶다면...

### [https://velog.io/@leobit/CommonJS](https://velog.io/@leobit/CommonJS)
